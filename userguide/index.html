

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Guide &mdash; DYCOVE 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=01f34227"></script>
      <script src="../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Examples" href="../examples/index.html" />
    <link rel="prev" title="Background" href="../background/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            DYCOVE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/index.html">Background</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-steps">General Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="#imports">Imports</a></li>
<li class="toctree-l2"><a class="reference internal" href="#defining-the-vegetation-species">Defining the Vegetation Species</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-the-model-interface-delft3d-fm">Creating the Model Interface (Delft3D FM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-the-model-interface-anuga">Creating the Model Interface (ANUGA)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-vegetation-species">Multiple Vegetation Species</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-simulation">Running the Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#outputs">Outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plotting">Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plotting-results-with-multiple-species">Plotting Results with Multiple Species</a></li>
<li class="toctree-l2"><a class="reference internal" href="#accessing-and-plotting-outputs-directly">Accessing and Plotting Outputs Directly</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apiref/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DYCOVE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">User Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/userguide/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="user-guide">
<span id="id1"></span><h1>User Guide<a class="headerlink" href="#user-guide" title="Link to this heading"></a></h1>
<p>This user guide provides a quick overview of how to use DYCOVE.
Users can get started by reviewing this guide and running the <a class="reference internal" href="../examples/index.html#examples"><span class="std std-ref">Examples</span></a>, but advanced use of DYCOVE requires an understanding of the concepts discussed in the <a class="reference internal" href="../background/index.html#background"><span class="std std-ref">Background</span></a>.</p>
<section id="general-steps">
<h2>General Steps<a class="headerlink" href="#general-steps" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Create a <a class="reference internal" href="../_autosummary/dycove.sim.vegetation.VegetationSpecies.html#dycove.sim.vegetation.VegetationSpecies" title="dycove.sim.vegetation.VegetationSpecies"><code class="xref py py-class docutils literal notranslate"><span class="pre">VegetationSpecies</span></code></a> instance using a vegetation attribute <cite>.json</cite> file.</p></li>
<li><p>Create a <a class="reference internal" href="../_autosummary/dycove.sim.base.HydroSimulationBase.html#dycove.sim.base.HydroSimulationBase" title="dycove.sim.base.HydroSimulationBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">HydroSimulationBase</span></code></a> instance by combining numerical model inputs/pointers with the <a class="reference internal" href="../_autosummary/dycove.sim.vegetation.VegetationSpecies.html#dycove.sim.vegetation.VegetationSpecies" title="dycove.sim.vegetation.VegetationSpecies"><code class="xref py py-class docutils literal notranslate"><span class="pre">VegetationSpecies</span></code></a> object.
This would be called as either <a class="reference internal" href="../_autosummary/dycove.sim.engines.ANUGA_hydro.ANUGA.html#dycove.sim.engines.ANUGA_hydro.ANUGA" title="dycove.sim.engines.ANUGA_hydro.ANUGA"><code class="xref py py-class docutils literal notranslate"><span class="pre">ANUGA</span></code></a> or <a class="reference internal" href="../_autosummary/dycove.sim.engines.DFM_hydro.DFM.html#dycove.sim.engines.DFM_hydro.DFM" title="dycove.sim.engines.DFM_hydro.DFM"><code class="xref py py-class docutils literal notranslate"><span class="pre">DFM</span></code></a>, depending on which numerical model is used.</p></li>
<li><p>Run the simulation using <a class="reference internal" href="../_autosummary/dycove.sim.base.HydroSimulationBase.html#dycove.sim.base.HydroSimulationBase.run_simulation" title="dycove.sim.base.HydroSimulationBase.run_simulation"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run_simulation()</span></code></a> by providing simulation time parameters.</p></li>
<li><p>Inspect outputs using built-in plotting functions or external tools.</p></li>
</ol>
</section>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Link to this heading"></a></h2>
<p>Import DYCOVE’s public API as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dycove</span><span class="w"> </span><span class="kn">import</span> <span class="n">VegetationSpecies</span>                      <span class="c1"># main vegetation class</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dycove</span><span class="w"> </span><span class="kn">import</span> <span class="n">MultipleVegetationSpecies</span> <span class="k">as</span> <span class="n">MultiVeg</span>  <span class="c1"># for combining multiple species</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dycove</span><span class="w"> </span><span class="kn">import</span> <span class="n">ANUGA_hydro</span>                            <span class="c1"># ANUGA model interface</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dycove</span><span class="w"> </span><span class="kn">import</span> <span class="n">DFM_hydro</span>                              <span class="c1"># Delft3D FM model interface</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dycove</span><span class="w"> </span><span class="kn">import</span> <span class="n">plotting</span>                               <span class="c1"># model plotting module</span>
</pre></div>
</div>
<p>Of course, users would only import the numerical model interface they plan to use.</p>
</section>
<section id="defining-the-vegetation-species">
<h2>Defining the Vegetation Species<a class="headerlink" href="#defining-the-vegetation-species" title="Link to this heading"></a></h2>
<p>Creating the vegetation species object is the first step in setting up a DYCOVE simulation.
This object contains all of the vegetation attributes needed to run the simulation, read from a user-provided <cite>.json</cite> file (see the <a class="reference internal" href="../background/index.html#input-json"><span class="std std-ref">Background</span></a> for details on the required inputs).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">veg</span> <span class="o">=</span> <span class="n">VegetationSpecies</span><span class="p">(</span><span class="s2">&quot;path/to/vegetation_attributes.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Creating a <a class="reference internal" href="../_autosummary/dycove.sim.vegetation.VegetationSpecies.html#dycove.sim.vegetation.VegetationSpecies" title="dycove.sim.vegetation.VegetationSpecies"><code class="xref py py-class docutils literal notranslate"><span class="pre">VegetationSpecies</span></code></a> object automatically creates a <a class="reference internal" href="../_autosummary/dycove.sim.vegetation_data.VegetationAttributes.html#dycove.sim.vegetation_data.VegetationAttributes" title="dycove.sim.vegetation_data.VegetationAttributes"><code class="xref py py-class docutils literal notranslate"><span class="pre">VegetationAttributes</span></code></a> instance, which contains all of the vegetation attributes read from the input file.
Following the first colonization of the simulation, a <a class="reference internal" href="../_autosummary/dycove.sim.vegetation_data.VegCohort.html#dycove.sim.vegetation_data.VegCohort" title="dycove.sim.vegetation_data.VegCohort"><code class="xref py py-class docutils literal notranslate"><span class="pre">VegCohort</span></code></a> object is also created.</p>
</section>
<section id="creating-the-model-interface-delft3d-fm">
<h2>Creating the Model Interface (Delft3D FM)<a class="headerlink" href="#creating-the-model-interface-delft3d-fm" title="Link to this heading"></a></h2>
<p>Instantiate the model interface by calling <a class="reference internal" href="../_autosummary/dycove.sim.engines.DFM_hydro.DFM.html#dycove.sim.engines.DFM_hydro.DFM" title="dycove.sim.engines.DFM_hydro.DFM"><code class="xref py py-class docutils literal notranslate"><span class="pre">DFM</span></code></a>.
This class inherits <a class="reference internal" href="../_autosummary/dycove.sim.base.HydroSimulationBase.html#dycove.sim.base.HydroSimulationBase" title="dycove.sim.base.HydroSimulationBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">HydroSimulationBase</span></code></a>, which actually runs the simulation, and instantiates the Delft3D FM “engine” <a class="reference internal" href="../_autosummary/dycove.sim.engines.DFM_hydro.DFMEngine.html#dycove.sim.engines.DFM_hydro.DFMEngine" title="dycove.sim.engines.DFM_hydro.DFMEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">DFMEngine</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">DFM_hydro</span><span class="o">.</span><span class="n">DFM</span><span class="p">(</span><span class="s2">&quot;path/to/system/files/&quot;</span><span class="p">,</span> <span class="s1">&#39;dimr_config.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;model.mdu&#39;</span><span class="p">,</span> <span class="n">vegetation</span><span class="o">=</span><span class="n">veg</span><span class="p">)</span>
</pre></div>
</div>
<p>The first argument <code class="docutils literal notranslate"><span class="pre">dfm_path</span></code> points to the Delft3D FM system files (<cite>.dll</cite> library).
The directory must contains <cite>dflowfm/</cite> and <cite>dimr/</cite> directories.
On Windows machines, this directory might look like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfm_path</span> <span class="o">=</span> <span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">Program Files (x86)</span><span class="se">\\</span><span class="s1">Deltares</span><span class="se">\\</span><span class="s1">Delft3D Flexible Mesh Suite HM (2021.03)</span><span class="se">\\</span><span class="s1">plugins</span><span class="se">\\</span><span class="s1">DeltaShell.Dimr</span><span class="se">\\</span><span class="s1">kernels</span><span class="se">\\</span><span class="s1">x64&#39;</span>
</pre></div>
</div>
<p>The second argument <code class="docutils literal notranslate"><span class="pre">dimr_config</span></code> is the path to the DIMR configuration file, which will be located in your working directory, after exporting the model as DIMR from the GUI (see <a class="reference internal" href="../examples/dfm/tide_channel.html#tide-channel-dfm"><span class="std std-ref">tide channel example</span></a>).
The third argument <code class="docutils literal notranslate"><span class="pre">mdu_file</span></code> is the name of the Delft3D FM <cite>.mdu</cite> file.</p>
</section>
<section id="creating-the-model-interface-anuga">
<h2>Creating the Model Interface (ANUGA)<a class="headerlink" href="#creating-the-model-interface-anuga" title="Link to this heading"></a></h2>
<p>Instantiate the model interface by calling <a class="reference internal" href="../_autosummary/dycove.sim.engines.ANUGA_hydro.ANUGA.html#dycove.sim.engines.ANUGA_hydro.ANUGA" title="dycove.sim.engines.ANUGA_hydro.ANUGA"><code class="xref py py-class docutils literal notranslate"><span class="pre">ANUGA</span></code></a>.
This class inherits <a class="reference internal" href="../_autosummary/dycove.sim.base.HydroSimulationBase.html#dycove.sim.base.HydroSimulationBase" title="dycove.sim.base.HydroSimulationBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">HydroSimulationBase</span></code></a>, which actually runs the simulation, and instantiates the ANUGA “engine” <a class="reference internal" href="../_autosummary/dycove.sim.engines.ANUGA_hydro.AnugaEngine.html#dycove.sim.engines.ANUGA_hydro.AnugaEngine" title="dycove.sim.engines.ANUGA_hydro.AnugaEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnugaEngine</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">ANUGA_hydro</span><span class="o">.</span><span class="n">ANUGA</span><span class="p">(</span><span class="n">anuga_domain</span><span class="p">,</span> <span class="n">vegetation</span><span class="o">=</span><span class="n">veg</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">anuga_domain</span></code> object is the domain instance created for ANUGA simulations, after all aspects like elevation, friction, forcings, and boundary conditions have been assigned to it.</p>
</section>
<section id="multiple-vegetation-species">
<h2>Multiple Vegetation Species<a class="headerlink" href="#multiple-vegetation-species" title="Link to this heading"></a></h2>
<p>Users have the option to model multiple species together, using <a class="reference internal" href="../_autosummary/dycove.sim.vegetation.MultipleVegetationSpecies.html#dycove.sim.vegetation.MultipleVegetationSpecies" title="dycove.sim.vegetation.MultipleVegetationSpecies"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultipleVegetationSpecies</span></code></a>.
A separate <cite>.json</cite> file and <a class="reference internal" href="../_autosummary/dycove.sim.vegetation.VegetationSpecies.html#dycove.sim.vegetation.VegetationSpecies" title="dycove.sim.vegetation.VegetationSpecies"><code class="xref py py-class docutils literal notranslate"><span class="pre">VegetationSpecies</span></code></a> object are needed for that species, which can be added to model like so (using the ANUGA engine as an example):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">veg_alt</span> <span class="o">=</span> <span class="n">VegetationSpecies</span><span class="p">(</span><span class="s2">&quot;path/to/vegetation_attributes_alt.json&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ANUGA_hydro</span><span class="o">.</span><span class="n">ANUGA</span><span class="p">(</span><span class="n">anuga_domain</span><span class="p">,</span> <span class="n">vegetation</span><span class="o">=</span><span class="n">MultiVeg</span><span class="p">[</span><span class="n">veg</span><span class="p">,</span> <span class="n">veg_alt</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="running-the-simulation">
<h2>Running the Simulation<a class="headerlink" href="#running-the-simulation" title="Link to this heading"></a></h2>
<p>Users can run a simulation using the following method of <a class="reference internal" href="../_autosummary/dycove.sim.base.HydroSimulationBase.html#dycove.sim.base.HydroSimulationBase" title="dycove.sim.base.HydroSimulationBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">HydroSimulationBase</span></code></a>, with only the total desired simulation time as an input:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">run_simulation</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">sim_time_unit</span><span class="o">=</span><span class="s2">&quot;eco-morphodynamic years&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that there are several optional arguments of <a class="reference internal" href="../_autosummary/dycove.sim.base.HydroSimulationBase.html#dycove.sim.base.HydroSimulationBase.run_simulation" title="dycove.sim.base.HydroSimulationBase.run_simulation"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run_simulation()</span></code></a> that define the time scaling of DYCOVE models, which are described in the API and in greater detail in the <a class="reference internal" href="../background/index.html#eco-time-scale"><span class="std std-ref">Background</span></a>.</p>
</section>
<section id="outputs">
<h2>Outputs<a class="headerlink" href="#outputs" title="Link to this heading"></a></h2>
<p>Numerical model outputs can be accessed and inspected as they typically would be without vegetation.
For Delft3D FM, the <cite>_his.nc</cite> file for point output and <cite>_map.nc</cite> file for map output are found in the <cite>/dflowfm/output</cite> directory.
For ANUGA, the output <cite>.sww</cite> file is located in the working directory.</p>
<p>DYCOVE vegetation outputs are found in <cite>/dflowfm/veg_output</cite> for Delft3D FM and in <cite>/veg_output</cite> for ANUGA.
DYCOVE output consists of a series of <cite>.nc</cite> (<cite>netCDF</cite>) files, one file per vegetation cohort per ecological time step.
One <cite>.nc</cite> file represents the attribute state of a single vegetation cohort at a point in time.
It contains all of the attributes that are stored in a <a class="reference internal" href="../_autosummary/dycove.sim.vegetation_data.VegCohort.html#dycove.sim.vegetation_data.VegCohort" title="dycove.sim.vegetation_data.VegCohort"><code class="xref py py-class docutils literal notranslate"><span class="pre">VegCohort</span></code></a> object (fractions, stem heights, mortality fractions, etc.).
It also contains metadata with the current ecological year and Ecological Time Step (ETS), species name, and cohort ID number.</p>
</section>
<section id="plotting">
<h2>Plotting<a class="headerlink" href="#plotting" title="Link to this heading"></a></h2>
<p>DYCOVE features a built-in plotting class <a class="reference internal" href="../_autosummary/dycove.utils.plotting.ModelPlotter.html#dycove.utils.plotting.ModelPlotter" title="dycove.utils.plotting.ModelPlotter"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelPlotter</span></code></a> that can be used to plot time series of 2-D quantities from both the numerical model and DYCOVE:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="n">plotter</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">ModelPlotter</span><span class="p">(</span>
    <span class="n">simdir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">),</span>
    <span class="c1"># or: quantity = &quot;Velocity&quot;, etc. See examples and ModelPlotter API for list of quantities</span>
    <span class="n">quantity</span> <span class="o">=</span> <span class="s2">&quot;Stem Height&quot;</span><span class="p">,</span>
    <span class="n">plot_times</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;plotHR_0&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="o">*</span><span class="mf">24.</span><span class="p">,</span>
        <span class="s2">&quot;plotHR_f&quot;</span><span class="p">:</span> <span class="mi">21</span><span class="o">*</span><span class="mf">24.</span><span class="p">,</span>
        <span class="s2">&quot;mapHR_int&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;plotHR_int&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Attributes in the <cite>.nc</cite> file that are 1-D arrays (fractions, mortality fractions) use the same indexing as the underlying mesh, and can be interpolated to 2-D grids using the 1-D <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">Y</span></code> arrays in the numerical model output files.
Users can create an interpolation function directly using <a class="reference internal" href="../_autosummary/dycove.utils.plotting.create_nn_interpFunc.html#dycove.utils.plotting.create_nn_interpFunc" title="dycove.utils.plotting.create_nn_interpFunc"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_nn_interpFunc()</span></code></a>.
This function is created and called as shown in <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_quantity_grids()</span></code>.
Loading of vegetation output files is performed in <a class="reference internal" href="../_autosummary/dycove.utils.model_loader.BaseMapLoader.html#dycove.utils.model_loader.BaseMapLoader" title="dycove.utils.model_loader.BaseMapLoader"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseMapLoader</span></code></a>, while loading of numerical model outputs occurs in <a class="reference internal" href="../_autosummary/dycove.utils.model_loader.ANUGAMapLoader.html#dycove.utils.model_loader.ANUGAMapLoader" title="dycove.utils.model_loader.ANUGAMapLoader"><code class="xref py py-class docutils literal notranslate"><span class="pre">ANUGAMapLoader</span></code></a> or <a class="reference internal" href="../_autosummary/dycove.utils.model_loader.DFMMapLoader.html#dycove.utils.model_loader.DFMMapLoader" title="dycove.utils.model_loader.DFMMapLoader"><code class="xref py py-class docutils literal notranslate"><span class="pre">DFMMapLoader</span></code></a>.</p>
<p><a class="reference internal" href="../_autosummary/dycove.utils.plotting.ModelPlotter.html#dycove.utils.plotting.ModelPlotter" title="dycove.utils.plotting.ModelPlotter"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelPlotter</span></code></a> is customizable and has many optional arguments, which are detailed in the API docs.</p>
</section>
<section id="plotting-results-with-multiple-species">
<span id="plot-multi-species"></span><h2>Plotting Results with Multiple Species<a class="headerlink" href="#plotting-results-with-multiple-species" title="Link to this heading"></a></h2>
<p>Plotting results of simulations with multiple species using <a class="reference internal" href="../_autosummary/dycove.utils.plotting.ModelPlotter.html#dycove.utils.plotting.ModelPlotter" title="dycove.utils.plotting.ModelPlotter"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelPlotter</span></code></a> is no different from plotting results of a single-species simulation.
Plotting stem height, for example, will average all stem heights in each grid cell among the various species and life stages present within that cell.
When plotting vegetation fractions or mortality, however, <a class="reference internal" href="../_autosummary/dycove.utils.plotting.ModelPlotter.html#dycove.utils.plotting.ModelPlotter" title="dycove.utils.plotting.ModelPlotter"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelPlotter</span></code></a> will create individual plots for each species.
Example: A simulation of one ecological year and two species consists of, say, one colonization event for each species in the second ETS of the year.
Plots of stem heights will consist of one plot per ETS, starting at ETS 2.
Plots of fractions will consist of two plots per ETS, one for each species, starting at ETS 2.</p>
</section>
<section id="accessing-and-plotting-outputs-directly">
<h2>Accessing and Plotting Outputs Directly<a class="headerlink" href="#accessing-and-plotting-outputs-directly" title="Link to this heading"></a></h2>
<p>The following explanations and examples are for users who prefer to develop their own plotting codes.
ANUGA model quantities can be read from the output <cite>.sww</cite> file using the <code class="docutils literal notranslate"><span class="pre">xarray</span></code> library (also <code class="docutils literal notranslate"><span class="pre">netCDF4</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>

<span class="n">map_vars</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;path/to/anuga_model.sww&quot;</span><span class="p">)</span>
<span class="n">x_nodes</span> <span class="o">=</span> <span class="n">map_vars</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
<span class="n">y_nodes</span> <span class="o">=</span> <span class="n">map_vars</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
<span class="n">z_nodes</span> <span class="o">=</span> <span class="n">map_vars</span><span class="p">[</span><span class="s2">&quot;elevation&quot;</span><span class="p">]</span>
<span class="n">stage</span> <span class="o">=</span> <span class="n">map_vars</span><span class="p">[</span><span class="s2">&quot;stage&quot;</span><span class="p">]</span>
<span class="n">depth</span> <span class="o">=</span> <span class="n">stage</span> <span class="o">-</span> <span class="n">elevation</span>
</pre></div>
</div>
<p>These are 1-D arrays, that can be interpolated using <a class="reference internal" href="../_autosummary/dycove.utils.plotting.create_nn_interpFunc.html#dycove.utils.plotting.create_nn_interpFunc" title="dycove.utils.plotting.create_nn_interpFunc"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_nn_interpFunc()</span></code></a> or other tools.
Note that <cite>stage</cite> and other time-varying quantities have a time axis as the first axis (same with DFM).
Centroid data is also included in the <cite>.sww</cite> file, but <cite>x</cite> and <cite>y</cite> values at centroids would need to be computed as they are in <code class="docutils literal notranslate"><span class="pre">~dycove.utils.model_loader.ANUGAMapLoader._load_outputs</span></code>.</p>
<p>Similarly, DFM model (centroid) quantities can be read from the output <cite>_map.nc</cite> file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">map_vars</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;path/to/dflowfm/output/FlowFM_map.nc&quot;</span><span class="p">)</span>
<span class="n">x_nodes</span> <span class="o">=</span> <span class="n">map_vars</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
<span class="n">y_nodes</span> <span class="o">=</span> <span class="n">map_vars</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
<span class="n">z_nodes</span> <span class="o">=</span> <span class="n">map_vars</span><span class="p">[</span><span class="s2">&quot;elevation&quot;</span><span class="p">]</span>
<span class="n">stage</span> <span class="o">=</span> <span class="n">map_vars</span><span class="p">[</span><span class="s2">&quot;stage&quot;</span><span class="p">]</span>
<span class="n">depth</span> <span class="o">=</span> <span class="n">stage</span> <span class="o">-</span> <span class="n">elevation</span>
</pre></div>
</div>
<p>Vegetation quantities can be accessed via the files in the <cite>veg_output</cite> directory.
Quantities that are saved in these output files are listed as attributes of the <a class="reference internal" href="../_autosummary/dycove.sim.vegetation_data.VegCohort.html#dycove.sim.vegetation_data.VegCohort" title="dycove.sim.vegetation_data.VegCohort"><code class="xref py py-class docutils literal notranslate"><span class="pre">VegCohort</span></code></a> class.
The simplest way to load and plot quantities (outside of <a class="reference internal" href="../_autosummary/dycove.utils.plotting.ModelPlotter.html#dycove.utils.plotting.ModelPlotter" title="dycove.utils.plotting.ModelPlotter"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelPlotter</span></code></a>) is provided below.
While vegetation fractions and cohorts are tracked individually in DYCOVE, we typically plot quantities as a weighted average in each grid cell, with weights determined by the fractions present in the cell.
It also involves reading in the underlying hydrodynamic model file for interpolating to a grid:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dycove.utils.array_math</span><span class="w"> </span><span class="kn">import</span> <span class="n">cell_averaging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dycove.utils.plotting</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_nn_interpFunc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dycove.utils.model_loader</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_veg_file_index</span><span class="p">,</span> <span class="n">get_anuga_centroid_coords</span>

<span class="n">model_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./anuga_model&quot;</span><span class="p">)</span>
<span class="n">veg_dir</span> <span class="o">=</span> <span class="n">model_dir</span> <span class="o">/</span> <span class="s2">&quot;veg_output&quot;</span>

<span class="c1"># Load ANUGA (or DFM) output, read X and Y coordinate arrays</span>
<span class="n">map_vars</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="n">model_dir</span> <span class="o">/</span> <span class="s2">&quot;rectang_beach.sww&quot;</span><span class="p">)</span>

<span class="c1"># Convert ANUGA vertex coordinates to centroids (may take a little time)</span>
<span class="n">x_c</span><span class="p">,</span> <span class="n">y_c</span> <span class="o">=</span> <span class="n">get_anuga_centroid_coords</span><span class="p">(</span><span class="n">map_vars</span><span class="p">)</span>

<span class="c1"># Create interpolation function for 10-m grid. Can also provide as an argument a polygon .csv file to mask outside domain.</span>
<span class="n">interp_func</span> <span class="o">=</span> <span class="n">create_nn_interpFunc</span><span class="p">(</span><span class="n">x_c</span><span class="p">,</span> <span class="n">y_c</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="c1"># Interpolate model bathymetry to use as a base map (using centroids)</span>
<span class="n">z_grid</span> <span class="o">=</span> <span class="n">interp_func</span><span class="p">(</span><span class="n">map_vars</span><span class="p">[</span><span class="s2">&quot;elevation_c&quot;</span><span class="p">])</span>

<span class="c1"># Do preliminary sweep through cohort files to find year/ETS information</span>
<span class="n">file_mapping</span> <span class="o">=</span> <span class="n">get_veg_file_index</span><span class="p">(</span><span class="n">veg_dir</span><span class="p">)</span>

<span class="c1"># Loop through all saved cohort files saved for a given year and ETS, load and plot data</span>
<span class="k">for</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">ets</span><span class="p">)</span> <span class="ow">in</span> <span class="n">file_mapping</span><span class="p">:</span>
    <span class="n">fractions</span><span class="p">,</span> <span class="n">stem_heights</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">file_mapping</span><span class="p">[(</span><span class="n">year</span><span class="p">,</span> <span class="n">ets</span><span class="p">)]:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

        <span class="c1"># Append to list all data from this ETS</span>
        <span class="n">fractions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">data_vars</span><span class="p">[</span><span class="s1">&#39;fraction&#39;</span><span class="p">])</span>
        <span class="n">stem_heights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">])</span>

    <span class="c1"># Do weighted average based on vegetation fractions in each cell</span>
    <span class="n">stemht_avg</span> <span class="o">=</span> <span class="n">cell_averaging</span><span class="p">(</span><span class="n">fractions</span><span class="p">,</span> <span class="n">stem_heights</span><span class="p">)</span>

    <span class="c1"># Interpolate to grid and mask out non-vegetated cells</span>
    <span class="n">stemht_grid</span> <span class="o">=</span> <span class="n">interp_func</span><span class="p">(</span><span class="n">stemht_avg</span><span class="p">)</span>
    <span class="n">stemht_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">stemht_grid</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">stemht_grid</span><span class="p">)</span>

    <span class="c1"># Do plotting</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">im_base</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">z_grid</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys_r&quot;</span><span class="p">)</span>
    <span class="n">im_veg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">stemht_grid</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greens&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stem height [m] -- Eco year </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">, ETS </span><span class="si">{</span><span class="n">ets</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that for a given cohort, each <code class="docutils literal notranslate"><span class="pre">c['fraction']</span></code> is an array with one value per grid cell, while other quantities like <code class="docutils literal notranslate"><span class="pre">c.attrs['height']</span></code> are stored under <code class="docutils literal notranslate"><span class="pre">attrs</span></code> because they have only a single value per cohort, which grows over time.
Mortality outputs are arrays, similar to Fractions.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../background/index.html" class="btn btn-neutral float-left" title="Background" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../examples/index.html" class="btn btn-neutral float-right" title="Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, N. Tull, M. Brückner.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>